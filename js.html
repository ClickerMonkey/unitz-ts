<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/semantic-ui@2.3.1/dist/semantic.min.css">

    <style>
    body > .grid {
      height: 100%;
    }
    body {
      background-color: #DADADA;
    }
    .column {
      max-width: 800px;
    }
    #unitz {
      margin-top: 2em;
      margin-bottom: 2em;
    }
    .ui.input.error>input,
    .ui.input.error>input:focus {
      background-color: #fff6f6;
      border-color: #e0b4b4;
      color: #9f3a38;
      -webkit-box-shadow: none;
      box-shadow: none;
    }
    pre button,
    pre .ui.selection.dropdown {
      width: auto;
      min-width: auto;
      height: 20px;
      font-family: Courier;
      color: rgba(0,0,0,.6);
    }
    pre input {
      border: 1px solid rgba(34,36,38,.15);
      border-radius: .28571429rem;
      height: 20px;
      font-family: Courier;
      color: rgba(0,0,0,.6);
      width: 200px;
    }
    </style>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.16/vue.js"></script>
    <script src="umd/unitz.js"></script>
  </head>
  <body>

    <div class="ui center aligned grid" id="unitz">
      <div class="column">

        <form class="ui large form">
          <div class="ui stacked segment">
            <div class="field">
              <div class="ui left icon input" :class="{ error: invalid }">
                <i class="arrow right icon"></i>
                <input type="text" v-model="input" @keyup="parse" placeholder="1 cups, 3 tbsp, 3.4 - 5 meters">
              </div>
            </div>
          </div>
        </form>

        <div class="ui segment left aligned">
          <div class="ui secondary pointing menu">
            <a class="item" :class="{ active: isActive('inspect') }" @click="setActive('inspect')">
              Inspect
            </a>
            <a class="item" :class="{ active: isActive('mutate') }" @click="setActive('mutate')">
              Mutate
            </a>
            <a class="item" :class="{ active: isActive('transform') }" @click="setActive('transform')">
              Transform
            </a>
            <a class="item" :class="{ active: isActive('operations') }" @click="setActive('operations')">
              Operations
            </a>
            <a class="item" :class="{ active: isActive('sort') }" @click="setActive('sort')">
              Sort
            </a>
            <a class="item" :class="{ active: isActive('convert') }" @click="setActive('convert')">
              Convert
            </a>
            <a class="item" :class="{ active: isActive('conversions') }" @click="setActive('conversions')">
              Conversions
            </a>
          </div>
          <div v-if="isActive('inspect')">

            <unitz-sample
              input="1 - 2&quot;, 5m, 3/4kb, 1in - 4ft, 0.5day"
              @chosen="setInput"
            ></unitz-sample>

            <div class="ui fluid card" v-for="range in parsed.ranges">
              <div class="content">

                <div class="header">
                  {{ output.range( range ) }}
                </div>

                <div class="description">

                  <div class="ui blue label">
                    Class
                    <div class="detail" v-if="range.min.group && !range.min.group.dynamic">
                      {{ range.min.group.parent.name }}
                    </div>
                    <div class="detail" v-else-if="range.min.group && range.min.group.dynamic">
                      Dynamic
                    </div>
                    <div class="detail" v-else>
                      None
                    </div>
                  </div>

                  <div class="ui teal label" v-if="range.min.group">
                    Group
                    <div class="detail">
                      <span v-if="range.min.group.unit !== range.max.group.unit">
                        {{ range.min.group.singularLong }} - {{ range.max.group.singularLong }}
                      </span>
                      <span v-else>
                        {{ range.min.group.singularLong }}
                      </span>
                    </div>
                  </div>

                  <div class="ui gray label">
                    Range
                    <div class="detail">
                      {{ range.isRange ? 'Yes' : 'No' }}
                    </div>
                  </div>

                  <div class="ui green label">
                    Valid
                    <div class="detail">
                      {{ range.isValid ? 'Yes' : 'No' }}
                    </div>
                  </div>

                  <div class="ui purple label">
                    Fractions
                    <div class="detail">
                      {{ range.isFraction ? 'Yes' : 'No' }}
                    </div>
                  </div>

                </div>
              </div>
            </div>

          </div>
          <div v-if="isActive('mutate')">

            <unitz-sample
              input="2.3 inches, -3 - 2 METER, 0/2 tacos, 1 1/2ft"
              @chosen="setInput"
            ></unitz-sample>

            <br><br>

            <div class="ui styled fluid accordion">
              <div class="title" @click="optionsOpen = !optionsOpen" :class="{active: optionsOpen}">
                <i class="dropdown icon"></i>
                Options
              </div>
              <div class="content" :class="{active: optionsOpen}">
                <unitz-output :output="output"></unitz-output>
              </div>
            </div>

            <unitz-card
              usage="uz( input ).preferred()"
              title="Preferred"
              description="This mutation takes the current expression and replaces the units given by the user with the units preferred by the developer."
              :result="preferred"
            ></unitz-card>

            <unitz-card
              usage="uz( input ).positive()"
              title="Positive"
              description="This mutation only returns positive values. If a range has a negative minimum and positive minimum the minimum is changed to zero."
              :result="positive"
            ></unitz-card>

            <unitz-card
              usage="uz( input ).negative()"
              title="Negative"
              description="This mutation only returns negative values. If a range has a negative minimum and positive maximum the maximum is changed to zero."
              :result="negative"
            ></unitz-card>

            <unitz-card
              usage="uz( input ).nonzero()"
              title="Non-zero"
              description="This mutation only returns non-zero values."
              :result="nonzero"
            ></unitz-card>

            <unitz-card
              usage="uz( input ).min()"
              title="Min"
              description="This mutation only returns the minimum values specifed (if ranges are given)."
              :result="min"
            ></unitz-card>

            <unitz-card
              usage="uz( input ).max()"
              title="Max"
              description="This mutation only returns the maximum values specifed (if ranges are given)."
              :result="max"
            ></unitz-card>

            <unitz-card
              usage="uz( input ).fractions()"
              title="Fractions"
              description="This mutation tries to convert all ranges and values to fractions based on their groups valid denominators."
              :result="fractions"
            ></unitz-card>

            <unitz-card
              usage="uz( input ).numbers()"
              title="Numbers"
              description="This mutation tries to convert all ranges and values to numbers (as oppposed to fractions)."
              :result="numbers"
            ></unitz-card>

          </div>
          <div v-if="isActive('transform')">

            <unitz-sample
              input="24 in, 1.5ft, 0.25ft"
              @chosen="setInput"
            ></unitz-sample>

            <unitz-sample
              input="1 loaf, 3 loaves, 1 lb"
              detail="shows how dynamic groups determine singular/plural"
              @chosen="setInput"
            ></unitz-sample>

            <br><br>

            <div class="ui styled fluid accordion">
              <div class="title" @click="optionsOpen = !optionsOpen" :class="{active: optionsOpen}">
                <i class="dropdown icon"></i>
                Options
              </div>
              <div class="content" :class="{active: optionsOpen}">
                <unitz-output :output="output"></unitz-output>
                <unitz-transform :transform="transform"></unitz-transform>
             </div>
           </div>

           <unitz-card
             usage="uz( input ).normalize( options )"
             title="Normalize"
             description="This transform adjusts the unit of each value or range to find the best match according to the transform options."
             :result="normalize"
           ></unitz-card>

           <unitz-card
             usage="uz( input ).compact( options )"
             title="Compact"
             description="This transforms values and ranges of the same class into a single value."
             :result="compact"
           ></unitz-card>

           <unitz-card
             usage="uz( input ).expand( options )"
             title="Expand"
             description="This transforms values and ranges of the same class into as many values as needed to nicely represent the sum."
             :result="expand"
           ></unitz-card>

           <unitz-card
             usage="uz( input ).filter( options )"
             title="Filter"
             description="This transform filters out values & ranges that don't match the options."
             :result="filter"
           ></unitz-card>

          </div>
          <div v-if="isActive('operations')">

            <div class="ui styled fluid accordion">
              <div class="title" @click="optionsOpen = !optionsOpen" :class="{active: optionsOpen}">
                <i class="dropdown icon"></i>
                Options
              </div>
              <div class="content" :class="{active: optionsOpen}">
                <unitz-output :output="output"></unitz-output>
              </div>
            </div>

            <div class="ui fluid card">
             <div class="content">
               <div class="ui right floated label">
                 uz( input ).add( addend, scale )
               </div>
               <div class="header">
                 Add
               </div>
               <div class="meta">
                 This operation adds two values together when their units match.
               </div>
               <br>
               <div class="ui form">
                <div class="inline fields">
                  <div class="four wide field">
                    <input type="text" v-model="input" @keyup="parse">
                  </div>
                  <div class="one wide field" style="font-size:18px;">+ (</div>
                  <div class="four wide field">
                    <input type="text" v-model="addend">
                  </div>
                  <div class="one wide field" style="font-size:18px;">x</div>
                  <div class="two wide field">
                    <input type="number" v-model="addendScale">
                  </div>
                  <div class="one wide field" style="font-size:18px;">) =</div>
                  <div class="six wide field">
                    <input type="text" readonly :value="add">
                  </div>
                </div>
              </div>
             </div>
            </div>

             <div class="ui fluid card">
              <div class="content">
                <div class="ui right floated label">
                  uz( input ).sub( addend, scale )
                </div>
                <div class="header">
                  Sub
                </div>
                <div class="meta">
                  This operation subtracts one value from another when their units match.
                </div>
                <br>
                <div class="ui form">
                 <div class="inline fields">
                   <div class="four wide field">
                     <input type="text" v-model="input" @keyup="parse">
                   </div>
                   <div class="one wide field" style="font-size:18px;">- (</div>
                   <div class="four wide field">
                     <input type="text" v-model="subtrahend">
                   </div>
                   <div class="one wide field" style="font-size:18px;">x</div>
                   <div class="two wide field">
                     <input type="number" v-model="subtrahendScale">
                   </div>
                   <div class="one wide field" style="font-size:18px;">) =</div>
                   <div class="six wide field">
                     <input type="text" readonly :value="sub">
                   </div>
                 </div>
               </div>
              </div>
             </div>

          </div>
          <div v-if="isActive('sort')">

            <div class="ui styled fluid accordion">
              <div class="title" @click="optionsOpen = !optionsOpen" :class="{active: optionsOpen}">
                <i class="dropdown icon"></i>
                Options
              </div>
              <div class="content" :class="{active: optionsOpen}">
                <unitz-sort :sort="sort"></unitz-sort>
              </div>
            </div>

            <br>

            <div class="ui fluid labeled input">
              <div class="ui label">Output</div>
              <input type="text" readonly :value="sorted">
            </div>

          </div>
          <div v-if="isActive('convert')">

            <div class="ui styled fluid accordion">
              <div class="title" @click="optionsOpen = !optionsOpen" :class="{active: optionsOpen}">
                <i class="dropdown icon"></i>
                Options
              </div>
              <div class="content" :class="{active: optionsOpen}">
                <unitz-output :output="output"></unitz-output>
              </div>
            </div>

            <br>

            <select class="ui fluid selection dropdown" v-model="convertUnit">
              <optgroup v-for="parent in classes" :key="parent.name" v-bind:label="parent.name">
                <option v-for="group in parent.groups" :key="group.unit" :value="group.unit">
                  {{ group.singularLong }}
                </option>
              </optgroup>
            </select>

            <br>

            <div class="ui fluid labeled input">
              <div class="ui label">Output</div>
              <input type="text" readonly :value="converted">
            </div>

          </div>
          <div v-if="isActive('conversions')">

            <div class="ui styled fluid accordion">
              <div class="title" @click="optionsOpen = !optionsOpen" :class="{active: optionsOpen}">
                <i class="dropdown icon"></i>
                Options
              </div>
              <div class="content" :class="{active: optionsOpen}">
                <unitz-output :output="output"></unitz-output>
                <unitz-transform :transform="transform"></unitz-transform>
             </div>
           </div>

           <div class="ui top attached tabular menu">
             <a class="item"
              v-for="(ranges, className) in conversionsByClass"
              :key="className"
              :class="{active: activeClass === className}"
              @click="activeClass = className">
              {{ className }}
             </a>
           </div>
           <div class="ui bottom attached segment" v-if="conversionsByClass[ activeClass ]">
             <div class="ui very relaxed divided list">
               <div class="item"
                v-for="range in conversionsByClass[ activeClass ]">
                {{ range }}
              </div>
             </div>
           </div>

          </div>
        </div>
      </div>
    </div>

    <script type="text/template" id="template_output">
      <pre class="ui tertiary segment"><!--
  -->// this variable is used to modify output below
var outputOptions = {
  unit: <select class="ui selection dropdown" v-model="output.unit">
  <option :value="OutputUnit.NONE">Unitz.OutputUnit.NONE</option>
  <option :value="OutputUnit.GIVEN">Unitz.OutputUnit.GIVEN</option>
  <option :value="OutputUnit.SHORT">Unitz.OutputUnit.SHORT</option>
  <option :value="OutputUnit.LONG">Unitz.OutputUnit.LONG</option>
  </select>,
  format: <select class="ui selection dropdown" v-model="output.format">
  <option :value="OutputFormat.GIVEN">Unitz.OutputFormat.GIVEN</option>
  <option :value="OutputFormat.NUMBER">Unitz.OutputFormat.NUMBER</option>
  <option :value="OutputFormat.MIXED">Unitz.OutputFormat.MIXED</option>
  <option :value="OutputFormat.FRACTION">Unitz.OutputFormat.FRACTION</option>
  <option :value="OutputFormat.IMPROPER">Unitz.OutputFormat.IMPROPER</option>
  </select>,
  repeatUnit: <select class="ui selection dropdown" v-model="output.repeatUnit">
  <option :value="true">true</option>
  <option :value="false">false</option>
  </select>,
  unitSpacer: <input type="text" v-model="output.unitSpacer">,
  rangeSpacer: <input type="text" v-model="output.rangeSpacer">,
  fractionSpacer: <input type="text" v-model="output.fractionSpacer">,
  mixedSpacer: <input type="text" v-model="output.mixedSpacer">,
  delimiter: <input type="text" v-model="output.delimiter">,
  significant: <input type="number" v-model.number="output.significant">

};<!--
  --></pre>
    </script>

    <script type="text/template" id="template_transform">
      <pre class="ui tertiary segment"><!--
   -->// this variable is used to transform
var transformOptions = {
  common: <select class="ui selection dropdown" v-model="transform.common">
    <option :value="true">true</option>
    <option :value="false">false</option>
  </select>,
  system: <select class="ui selection dropdown" v-model="transform.system">
    <option :value="System.METRIC">Unitz.System.METRIC</option>
    <option :value="System.IMPERIAL">Unitz.System.IMPERIAL</option>
    <option :value="System.NONE">Unitz.System.NONE</option>
    <option :value="System.ANY">Unitz.System.ANY</option>
    <option :value="System.GIVEN">Unitz.System.GIVEN</option>
  </select>,
  min: <input type="text" v-model.number="transform.min"><button @click="transform.min=-Number.MAX_VALUE">reset</button>,
  max: <input type="text" v-model.number="transform.max"><button @click="transform.min=-Number.MAX_VALUE">reset</button>,
  convertWithMax: <select class="ui selection dropdown" v-model="transform.convertWithMax">
    <option :value="true">true</option>
    <option :value="false">false</option>
  </select>,
  groupless: <select class="ui selection dropdown" v-model="transform.groupless">
    <option :value="true">true</option>
    <option :value="false">false</option>
  </select>
};<!--
   --></pre>
    </script>

    <script type="text/template" id="template_sort">
      <pre class="ui tertiary segment"><!--
  -->// options passed to uz( input ).sort( sortOptions )
var sortOptions = {
  ascending: <select class="ui selection dropdown" v-model="sort.ascending">
  <option :value="true">true</option>
  <option :value="false">false</option>
  </select>,
  type: <select class="ui selection dropdown" v-model="sort.type">
  <option :value="SortType.MIN">Unitz.SortType.MIN</option>
  <option :value="SortType.MAX">Unitz.SortType.MAX</option>
  <option :value="SortType.AVERAGE">Unitz.SortType.AVERAGE</option>
  </select>
});<!--
   --></pre>
    </script>

    <script type="text/template" id="template_card">
      <div class="ui fluid card">
        <div class="content">
          <div class="ui right floated label">
            {{ usage }}
          </div>
          <div class="header">
            {{ title }}
          </div>
          <div class="meta">
            {{ description }}
          </div>
          <div class="description">
            <div class="ui fluid labeled input">
              <div class="ui label">Output</div>
              <input type="text" readonly :value="result">
            </div>
          </div>
        </div>
      </div>
    </script>

    <script type="text/template" id="template_sample">
      <a class="ui label" @click="choose">
        <i class="arrow up icon"></i>
        {{ input }}
        <div class="detail" v-if="detail" v-html="detail"></div>
      </a>
    </script>

    <script>
      new Vue({
        el: '#unitz',
        data: {
          input: '',
          addend: '',
          addendScale: 1,
          subtrahend: '',
          subtrahendScale: 1,
          optionsOpen: false,
          convertUnit: '',
          active: 'inspect',
          activeClass: null,
          parsed: Unitz.uz(),
          invalid: false,
          output: new Unitz.Output({unitSpacer: ' '}),
          transform: new Unitz.Transform(),
          sort: new Unitz.Sort(),
          classes: Unitz.Core.classes
        },
        computed: {
          preferred: function() {
            return this.parsed.preferred().output(this.output);
          },
          positive: function() {
            return this.parsed.positive().output(this.output);
          },
          negative: function() {
            return this.parsed.negative().output(this.output);
          },
          nonzero: function() {
            return this.parsed.nonzero().output(this.output);
          },
          min: function() {
            return this.parsed.min().output(this.output);
          },
          max: function() {
            return this.parsed.max().output(this.output);
          },
          numbers: function() {
            return this.parsed.numbers().output(this.output);
          },
          fractions: function() {
            return this.parsed.fractions().output(this.output);
          },
          normalize: function() {
            return this.parsed.normalize(this.transform, this.output).output(this.output);
          },
          compact: function() {
            return this.parsed.compact(this.transform).output(this.output);
          },
          expand: function() {
            return this.parsed.expand(this.transform).output(this.output);
          },
          filter: function() {
            return this.parsed.filter(this.transform).output(this.output);
          },
          sorted: function() {
            return this.parsed.sort(this.sort).output(this.output);
          },
          add: function() {
            return this.parsed.add(this.addend, this.addendScale).output(this.output);
          },
          sub: function() {
            return this.parsed.sub(this.subtrahend, this.subtrahendScale).output(this.output);
          },
          converted: function() {
            var result = this.parsed.convert(this.convertUnit);
            return result ? this.output.range(result) : '';
          },
          conversionsByClass: function() {
            var conversions = this.parsed.conversions(this.transform);
            var ranges = conversions.ranges;
            var byClass = {};
            for (var i = 0; i < ranges.length; i++) {
              var range = ranges[ i ];
              var className = range.min.group ? range.min.group.parent.name : 'Classless';
              var classRanges = byClass[ className ];
              if (!classRanges) {
                classRanges = byClass[ className ] = [];
              }
              classRanges.push( this.output.range( range ) );
            }
            return byClass;
          }
        },
        mounted: function() {
          Unitz.addDefaults();
        },
        methods: {
          parse: function() {
            var parsed = Unitz.uz(this.input);
            this.invalid = !parsed.isValid;
            if (parsed.isValid) {
              this.parsed = parsed;
            }
          },
          setInput: function(value) {
            this.input = value;
            this.parse();
          },
          setActive: function(tab) {
            this.active = tab;
          },
          isActive: function(tab) {
            return this.active === tab;
          }
        },
        components: {
          unitzOutput: {
            props: ['output'],
            template: '#template_output',
            data: function() {
              return {
                OutputUnit: Unitz.OutputUnit,
                OutputFormat: Unitz.OutputFormat
              };
            }
          },
          unitzTransform: {
            props: ['transform'],
            template: '#template_transform',
            data: function() {
              return {
                System: Unitz.System
              };
            }
          },
          unitzSort: {
            props: ['sort'],
            template: '#template_sort',
            data: function() {
              return {
                SortType: Unitz.SortType
              };
            }
          },
          unitzCard: {
            props: ['usage', 'title', 'description', 'result'],
            template: '#template_card'
          },
          unitzSample: {
            props: ['input', 'detail'],
            template: '#template_sample',
            methods: {
              choose: function() {
                this.$emit('chosen', this.input);
              }
            }
          }
        }
      });
    </script>

  </body>
</html>
